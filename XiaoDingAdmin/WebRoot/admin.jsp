<%@ page language="java" import="java.util.*" pageEncoding="utf-8"%>
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>用户管理</title>
		<link href="css/bootstrap.min.css" rel="stylesheet" type="text/css"></link>
		<link href="css/foodstyle.css" rel="stylesheet" type="text/css"></link>
		<link href="css/sb-admin-2.css" rel="stylesheet"></link>
	    <link href="component/metisMenu/dist/metisMenu.min.css" rel="stylesheet"></link>
	    
	    <link href="component/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="pagination/css/qunit-1.11.0.css">
  
		<script src="js/jquery.min.js"></script>
        <script src="js/bootstrap.min.js"></script> 
         <!-- Metis Menu Plugin JavaScript -->
	    <script src="component/metisMenu/dist/metisMenu.min.js"></script>
	   
	    <!-- Custom Theme JavaScript -->
	    <script src="js/sb-admin-2.js"></script>
	</head>
	<body>
		<!--
            	ä½èï¼un_hui@163.com
            	æ¶é´ï¼2016-05-01
            	æè¿°ï¼é¡¶é¨å¯¼èªæ 
         -->
		<div id="wrapper">
			 <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
			  <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="index.html">小丁美食管理后台</a>
              </div>
              <!-- /.navbar-header -->
              
              <ul class="nav navbar-top-links navbar-right">
              	<li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-envelope fa-fw"></i>  <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-messages">
                        <li>
                            <a href="#">
                                <div>
                                    <strong>John Smith</strong>
                                    <span class="pull-right text-muted">
                                        <em>Yesterday</em>
                                    </span>
                                </div>
                                <div>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque eleifend...</div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <strong>John Smith</strong>
                                    <span class="pull-right text-muted">
                                        <em>Yesterday</em>
                                    </span>
                                </div>
                                <div>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque eleifend...</div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <strong>John Smith</strong>
                                    <span class="pull-right text-muted">
                                    <em>Yesterday</em>
                                    </span>
                                </div>
                                <div>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque eleifend...</div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a class="text-center" href="#">
                                <strong>Read All Messages</strong>
                                <i class="fa fa-angle-right"></i>
                            </a>
                        </li>
                    </ul>
                    <!-- /.dropdown-messages -->
                </li>
                <!-- /.dropdown -->
                 <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-tasks fa-fw"></i>  <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-tasks">
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Task 1</strong>
                                        <span class="pull-right text-muted">40% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 40%">
                                            <span class="sr-only">40% Complete (success)</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Task 2</strong>
                                        <span class="pull-right text-muted">20% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 20%">
                                            <span class="sr-only">20% Complete</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Task 3</strong>
                                        <span class="pull-right text-muted">60% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%">
                                            <span class="sr-only">60% Complete (warning)</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Task 4</strong>
                                        <span class="pull-right text-muted">80% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 80%">
                                            <span class="sr-only">80% Complete (danger)</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a class="text-center" href="#">
                                <strong>See All Tasks</strong>
                                <i class="fa fa-angle-right"></i>
                            </a>
                        </li>
                    </ul>
                    <!-- /.dropdown-tasks -->
                </li>
                <!-- /.dropdown -->
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-bell fa-fw"></i>  <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-alerts">
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-comment fa-fw"></i> New Comment
                                    <span class="pull-right text-muted small">4 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-twitter fa-fw"></i> 3 New Followers
                                    <span class="pull-right text-muted small">12 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-envelope fa-fw"></i> Message Sent
                                    <span class="pull-right text-muted small">4 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-tasks fa-fw"></i> New Task
                                    <span class="pull-right text-muted small">4 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-upload fa-fw"></i> Server Rebooted
                                    <span class="pull-right text-muted small">4 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a class="text-center" href="#">
                                <strong>See All Alerts</strong>
                                <i class="fa fa-angle-right"></i>
                            </a>
                        </li>
                    </ul>
                    <!-- /.dropdown-alerts -->
                </li>
                <!-- /.dropdown -->
                 <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-user fa-fw"></i>  <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-user">
                        <li><a href="#"><i class="fa fa-user fa-fw"></i> User Profile</a>
                        </li>
                        <li><a href="#"><i class="fa fa-gear fa-fw"></i> Settings</a>
                        </li>
                        <li class="divider"></li>
                        <li><a href="login.html"><i class="fa fa-sign-out fa-fw"></i> Logout</a>
                        </li>
                    </ul>
                    <!-- /.dropdown-user -->
                </li>
                <!-- /.dropdown -->
            </ul>
            <!-- /.navbar-top-links -->
            
            <!--
            	侧边栏
            -->
            <div class="navbar-default sidebar" role="navigation">
                <div class="sidebar-nav navbar-collapse">
                	   <ul class="nav" id="side-menu">
                	   	 <li class="sidebar-search">
                            <div class="input-group custom-search-form">
                                <input type="text" class="form-control" placeholder="Search...">
                                <span class="input-group-btn">
	                                <button class="btn btn-default" type="button">
	                                    <i class="fa fa-search"></i>
	                                </button>
                                </span>
                            </div>
                            <!-- /input-group -->
                      </li>
                	   	  <li>
                            <a href="#"><i class="fa fa-lemon-o fa-fw"></i>美食管理<span class="fa arrow"></span></a>
                             <ul class="nav nav-second-level">
                                <li>
                                    <a href="index.jsp">文章管理</a>
                                </li>
                                <li>
                                    <a href="food.jsp">排行管理</a>
                                </li>
                            </ul>
                            <!-- /.nav-second-level -->
                      </li>
                	   	  <li>
                            <a href="label.jsp"><i class="fa fa-edit fa-fw"></i> 标签管理</a>
                           
                      </li>
                	   	   <li>
                            <a href="brand.jsp"><i class="fa fa-apple fa-fw"></i> 品牌管理</a>
                        </li>
                	   	    <li>
                            <a href="admin.jsp" class="active"><i class="fa fa-book fa-fw"></i> 用户管理</a>
                        </li>
                	   </ul>
                	</div>
                	<!-- /.sidebar-collapse -->
            </div>
              <!-- /.navbar-static-side -->
		  </nav>
			 <div id="page-wrapper">
			 	<div class="row">
			 		<div class="col-lg-12">
			 			<h1 class="page-header">用户管理</h1>
			 		</div>
			 	</div>
			 	<div class="row">
            			<div class="col-md-6 col-sm-6">
	                       <button class="btn btn-success" id="addUser">新增</button>
	                </div>
	           </div>
			 <div class="row">
	                 <div class="col-lg-12">
	                     <div class="dataTable_wrapper">
                    		 <table class="table table-striped table-bordered table-hover" id="user_table">
                                <thead>
                                    <tr>
                                        <th>用户</th>
                                        <th>密码</th>
                                        <th>角色</th>
                                    </tr>
                                </thead>
                                <tbody id="adminTable">
                                  
                                </tbody>
                           </table>
                      </div>
                      
	                </div>
	                <!-- /.col-lg-12 -->
                </div>
                <div class="row">
                 <div class="col-lg-12" style="text-align: center;">
                    <ul id='adminPager'></ul>
                 </div>
                </div>
			 <!--page-wrapper           -->
		</div>
		<!--wrapper           -->
		<script src="layer/layer.js"></script>
		<script src="layer/extend/layer.ext.js"></script>
		<script src="pagination/js/bootstrap-paginator.js"></script>
        <script src="pagination/js/qunit-1.11.0.js"></script>
        <script src="js/tableEditLine.js"></script>
		<script>
			$('#addUser').on('click', function(){
                //iframe
				layer.open({
				  type: 2,
				  title: '新增用户',
				  area: ['400px', '300px'],
				  fix: false, //
				  content: ['addUser.jsp','no']
				});
			});
			
			$(document).ready(function(){
				
				$.ajax({
				      url: "listUsers.action",
				      datatype: 'json',
				      type: "GET",
				      data: { "pageNo": 1 },
				      dataType: "json",
				      success: function (data) {
				    	  var curPage = 0;
						  var tPages = 11;
						  var pgSize = 5;
				        if (data != null) {
				          // alert("totalPages:" + data.totalPages + " , currentPage is " + data.currentPage);
				        	 tPages =  data.totalPages;
				        	 curPage = data.currentPage;
				        	 pgSize = data.sizeOfPage;
				             var tableShow="";
					           $.each(data.adminLists, function(i, item){
					        	  // alert(item.username + " ," + item.password);
					        	  tableShow += "<tr>";
					        	  tableShow += "<td>" +item.username +"</td>";
					        	  tableShow += "<td>" +item.password +"</td>";
					        	  tableShow += "<td>管理员</td>";
					        	  tableShow += "</tr>";
					             
					           });//end each
					           $('#adminTable').append(tableShow);
					           $.addEditTable();
					           
					           var element = $('#adminPager');
					            var options = {
					                bootstrapMajorVersion:3,
					                currentPage: curPage,
					                numberOfPages: pgSize,
					                totalPages: tPages,
					                itemTexts: function (type, page, current) {
					                switch (type) {
						                case "first":
						                  return "首页";
						                case "prev":
						                  return "上一页";
						                case "next":
						                  return "下一页";
						                case "last":
						                  return "末页";
						                case "page":
						                  return page;
					                  }
					              },
					              //点击事件，用于通过Ajax来刷新整个list列表
						            onPageClicked: function (event, originalEvent, type, page) {
						            	$('#adminTable').html("");
						            	$.ajax({
										      url: "listUsers.action",
										      datatype: 'json',
										      type: "GET",
										      data: { "pageNo": page},
										      dataType: "json",
										      success: function (data) {
										        if (data != null) {
										         //  alert("totalPages:" + data.totalPages + " , currentPage is " + data.currentPage);
										           var tableShow="";
										           $.each(data.adminLists, function(i, item){
										        	  // alert(item.username + " ," + item.password);
										        	  tableShow += "<tr>";
										        	  tableShow += "<td>" +item.username +"</td>";
										        	  tableShow += "<td>" +item.password +"</td>";
										        	  tableShow += "<td>管理员</td>";
										        	  tableShow += "</tr>";
										             
										           });
										           $('#adminTable').append(tableShow);
										           $.addEditTable();
										          // $('#adminTable').trigger("create");
										        }
										      }
										});//end $.ajax
						            }//onpageClicked
					            };//end of options

					            element.bootstrapPaginator(options);
				        }//end (data != null)
				      }//end success: function (data)
				});//end $.ajax
					
				
			});
		   $.addEditTable = function(){
			   $('#user_table').handleTable({ 
				    "handleFirst" : false, 
				    "cancel" : " <span class='glyphicon glyphicon-remove'></span> ", 
				    "edit" : " <span class='glyphicon glyphicon-edit'></span> ", 
				    "add" : " <span class='glyphicon glyphicon-plus'></span> ", 
				    "save" : " <span class='glyphicon glyphicon-saved'></span> ", 
				    "confirm" : "<span class='glyphicon glyphicon-ok'></span> ", 
				    "del":"<span class='glyphicon glyphicon-trash'></span>",
				    "operatePos" : -1, 
				    "editableCols" : [1], 
				    "order": ["edit","del"], 
				    "saveCallback" : function(ele, data, isSuccess) { //这里可以写ajax内容，用于保存编辑后的内容 
				      //ele 当前行
				     //data: 返回的数据 
				     //isSucess: 方法，用于保存数据成功后，将可编辑状态变为不可编辑状态 
				     var keyNode = $(ele).children('td').get(0);
				     var pass = data + " ";
				   // alert(pass + " , " + $(keyNode).text());
				     $.ajax({
					      url: "userUpdate.action",
					      datatype: 'json',
					      type: "POST",
					      data: { "userName": $(keyNode).text(), "password": pass},
					      dataType: "json",
					      success: function (data) {
					    	  isSuccess();
					    	//  alert(data);
					      }
				      });
				    
				    }, 
				    "addCallback" : function(data,isSuccess) { 
				     var flag = true; 
				     if(flag) { 
				      isSuccess(); 
				      alert(data + " 增加成功"); 
				     } else { 
				      alert(data + " 增加失败"); 
				     } 
				    }, 
				    "delCallback" : function(ele, isSuccess) { 
				    	
				    	 var keyNode = $(ele).children('td').get(0);
					     // alert(pass + " , " + $(keyNode).text());
					     layer.confirm("确定是否删除?", {
					    	 btn:["确定", "取消"]},
					    	 function(index){
					    		 $.ajax({
								      url: "userDel.action",
								      datatype: 'json',
								      type: "POST",
								      data: { "userName": $(keyNode).text()},
								      dataType: "json",
								      success: function (data) {
								    	  isSuccess();
								    	//  alert(data);
								      }
							      });
					    		layer.close(index);
					     });
				    } 
				}); 
		   };
		</script>
	</body>
</html>
